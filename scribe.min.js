(function(){function e(){}function t(e,t){for(var n=e.length;n--;)if(e[n].listener===t)return n;return-1}function n(e){return function(){return this[e].apply(this,arguments)}}var r=e.prototype,i=this,o=i.EventEmitter;r.getListeners=function(e){var t,n,r=this._getEvents();if(e instanceof RegExp){t={};for(n in r)r.hasOwnProperty(n)&&e.test(n)&&(t[n]=r[n])}else t=r[e]||(r[e]=[]);return t},r.flattenListeners=function(e){var t,n=[];for(t=0;t<e.length;t+=1)n.push(e[t].listener);return n},r.getListenersAsObject=function(e){var t,n=this.getListeners(e);return n instanceof Array&&(t={},t[e]=n),t||n},r.addListener=function(e,n){var r,i=this.getListenersAsObject(e),o="object"==typeof n;for(r in i)i.hasOwnProperty(r)&&-1===t(i[r],n)&&i[r].push(o?n:{listener:n,once:!1});return this},r.on=n("addListener"),r.addOnceListener=function(e,t){return this.addListener(e,{listener:t,once:!0})},r.once=n("addOnceListener"),r.defineEvent=function(e){return this.getListeners(e),this},r.defineEvents=function(e){for(var t=0;t<e.length;t+=1)this.defineEvent(e[t]);return this},r.removeListener=function(e,n){var r,i,o=this.getListenersAsObject(e);for(i in o)o.hasOwnProperty(i)&&(r=t(o[i],n),-1!==r&&o[i].splice(r,1));return this},r.off=n("removeListener"),r.addListeners=function(e,t){return this.manipulateListeners(!1,e,t)},r.removeListeners=function(e,t){return this.manipulateListeners(!0,e,t)},r.manipulateListeners=function(e,t,n){var r,i,o=e?this.removeListener:this.addListener,a=e?this.removeListeners:this.addListeners;if("object"!=typeof t||t instanceof RegExp)for(r=n.length;r--;)o.call(this,t,n[r]);else for(r in t)t.hasOwnProperty(r)&&(i=t[r])&&("function"==typeof i?o.call(this,r,i):a.call(this,r,i));return this},r.removeEvent=function(e){var t,n=typeof e,r=this._getEvents();if("string"===n)delete r[e];else if(e instanceof RegExp)for(t in r)r.hasOwnProperty(t)&&e.test(t)&&delete r[t];else delete this._events;return this},r.removeAllListeners=n("removeEvent"),r.emitEvent=function(e,t){var n,r,i,o,a=this.getListenersAsObject(e);for(i in a)if(a.hasOwnProperty(i))for(r=a[i].length;r--;)n=a[i][r],n.once===!0&&this.removeListener(e,n.listener),o=n.listener.apply(this,t||[]),o===this._getOnceReturnValue()&&this.removeListener(e,n.listener);return this},r.trigger=n("emitEvent"),r.emit=function(e){var t=Array.prototype.slice.call(arguments,1);return this.emitEvent(e,t)},r.setOnceReturnValue=function(e){return this._onceReturnValue=e,this},r._getOnceReturnValue=function(){return this.hasOwnProperty("_onceReturnValue")?this._onceReturnValue:!0},r._getEvents=function(){return this._events||(this._events={})},e.noConflict=function(){return i.EventEmitter=o,e},"function"==typeof define&&define.amd?define("event-emitter",[],function(){return e}):"object"==typeof module&&module.exports?module.exports=e:this.EventEmitter=e}).call(this),define("lodash-modern/internals/isNative",[],function(){function e(e){return"function"==typeof e&&r.test(e)}var t=Object.prototype,n=t.toString,r=RegExp("^"+String(n).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$");return e}),define("lodash-modern/internals/objectTypes",[],function(){var e={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1};return e}),define("lodash-modern/objects/isObject",["../internals/objectTypes"],function(e){function t(t){return!(!t||!e[typeof t])}return t}),define("lodash-modern/internals/shimKeys",["./objectTypes"],function(e){var t=Object.prototype,n=t.hasOwnProperty,r=function(t){var r,i=t,o=[];if(!i)return o;if(!e[typeof t])return o;for(r in i)n.call(i,r)&&o.push(r);return o};return r}),define("lodash-modern/objects/keys",["../internals/isNative","./isObject","../internals/shimKeys"],function(e,t,n){var r=e(r=Object.keys)&&r,i=r?function(e){return t(e)?r(e):[]}:n;return i}),define("lodash-modern/objects/defaults",["./keys","../internals/objectTypes"],function(e,t){var n=function(n,r,i){var o,a=n,s=a;if(!a)return s;for(var c=arguments,u=0,l="number"==typeof i?2:c.length;++u<l;)if(a=c[u],a&&t[typeof a])for(var d=-1,f=t[typeof a]&&e(a),p=f?f.length:0;++d<p;)o=f[d],"undefined"==typeof s[o]&&(s[o]=a[o]);return s};return n}),define("initializers/root-paragraph-element",[],function(){return function(){return function(e){""===e.getHTML().trim()&&e.setContent("<p><br></p>")}}}),define("initializers/insert-br-on-return",[],function(){function e(e){for(var t=document.createTreeWalker(e);t.nextNode();)if(t.currentNode&&(~["br"].indexOf(t.currentNode.nodeName.toLowerCase())||t.currentNode.length>0))return!0;return!1}return function(){return function(t){t.el.addEventListener("keydown",function(n){if(13===n.keyCode){var r=new t.api.Selection,i=r.range,o=r.getContaining(function(e){return"LI"===e.nodeName||/^(H[1-6])$/.test(e.nodeName)});if(!o){n.preventDefault(),"BR"===t.el.lastChild.nodeName&&t.el.removeChild(t.el.lastChild);var a=document.createElement("br");i.insertNode(a),i.collapse(!1);var s=i.cloneRange();s.setEndAfter(t.el.lastChild,0);var c=s.cloneContents();if(!e(c)){var u=document.createElement("br");i.insertNode(u)}var l=i.cloneRange();l.setStartAfter(a,0),l.setEndAfter(a,0),r.selection.removeAllRanges(),r.selection.addRange(l),t.pushHistory(),t.trigger("content-changed")}}}.bind(this)),""===t.getHTML().trim()&&t.setContent("")}}}),define("plugins/core/commands/indent",[],function(){return function(){return function(e){var t=new e.api.Command("indent");t.queryEnabled=function(){var t=new e.api.Selection,n=t.getContaining(function(e){return"UL"===e.nodeName||"OL"===e.nodeName});return e.api.Command.prototype.queryEnabled.call(this)&&e.allowsBlockElements()&&!n},e.commands.indent=t}}}),define("lodash-modern/internals/baseIndexOf",[],function(){function e(e,t,n){for(var r=(n||0)-1,i=e?e.length:0;++r<i;)if(e[r]===t)return r;return-1}return e}),define("lodash-modern/utilities/noop",[],function(){function e(){}return e}),define("lodash-modern/internals/baseCreate",["./isNative","../objects/isObject","../utilities/noop"],function(e,t){function n(e){return t(e)?r(e):{}}var r=e(r=Object.create)&&r;return r||(n=function(){function e(){}return function(n){if(t(n)){e.prototype=n;var r=new e;e.prototype=null}return r||window.Object()}}()),n}),define("lodash-modern/internals/setBindData",["./isNative","../utilities/noop"],function(e,t){var n={configurable:!1,enumerable:!1,value:null,writable:!1},r=function(){try{var t={},n=e(n=Object.defineProperty)&&n,r=n(t,t,t)&&n}catch(i){}return r}(),i=r?function(e,t){n.value=t,r(e,"__bindData__",n)}:t;return i}),define("lodash-modern/internals/slice",[],function(){function e(e,t,n){t||(t=0),"undefined"==typeof n&&(n=e?e.length:0);for(var r=-1,i=n-t||0,o=Array(0>i?0:i);++r<i;)o[r]=e[t+r];return o}return e}),define("lodash-modern/internals/baseBind",["./baseCreate","../objects/isObject","./setBindData","./slice"],function(e,t,n,r){function i(i){function o(){if(c){var n=r(c);a.apply(n,arguments)}if(this instanceof o){var i=e(s.prototype),l=s.apply(i,n||arguments);return t(l)?l:i}return s.apply(u,n||arguments)}var s=i[0],c=i[2],u=i[4];return n(o,i),o}var o=[],a=o.push;return i}),define("lodash-modern/internals/baseCreateWrapper",["./baseCreate","../objects/isObject","./setBindData","./slice"],function(e,t,n,r){function i(o){function s(){var n=m?f:this;if(l){var o=r(l);a.apply(o,arguments)}if((d||g)&&(o||(o=r(arguments)),d&&a.apply(o,d),g&&o.length<p))return u|=16,i([c,y?u:-4&u,o,null,f,p]);if(o||(o=arguments),h&&(c=n[v]),this instanceof s){n=e(c.prototype);var b=c.apply(n,o);return t(b)?b:n}return c.apply(n,o)}var c=o[0],u=o[1],l=o[2],d=o[3],f=o[4],p=o[5],m=1&u,h=2&u,g=4&u,y=8&u,v=c;return n(s,o),s}var o=[],a=o.push;return i}),define("lodash-modern/objects/isFunction",[],function(){function e(e){return"function"==typeof e}return e}),define("lodash-modern/internals/createWrapper",["./baseBind","./baseCreateWrapper","../objects/isFunction","./slice"],function(e,t,n,r){function i(o,c,u,l,d,f){var p=1&c,m=2&c,h=4&c,g=16&c,y=32&c;if(!m&&!n(o))throw new TypeError;g&&!u.length&&(c&=-17,g=u=!1),y&&!l.length&&(c&=-33,y=l=!1);var v=o&&o.__bindData__;if(v&&v!==!0)return v=r(v),v[2]&&(v[2]=r(v[2])),v[3]&&(v[3]=r(v[3])),!p||1&v[1]||(v[4]=d),!p&&1&v[1]&&(c|=8),!h||4&v[1]||(v[5]=f),g&&a.apply(v[2]||(v[2]=[]),u),y&&s.apply(v[3]||(v[3]=[]),l),v[1]|=c,i.apply(null,v);var b=1==c||17===c?e:t;return b([o,c,u,l,d,f])}var o=[],a=o.push,s=o.unshift;return i}),define("lodash-modern/functions/bind",["../internals/createWrapper","../internals/slice"],function(e,t){function n(n,r){return arguments.length>2?e(n,17,t(arguments,2),null,r):e(n,1,null,null,r)}return n}),define("lodash-modern/utilities/identity",[],function(){function e(e){return e}return e}),define("lodash-modern/support",["./internals/isNative"],function(e){var t=/\bthis\b/,n={};return n.funcDecomp=!e(window.WinRTError)&&t.test(function(){return this}),n.funcNames="string"==typeof Function.name,n}),define("lodash-modern/internals/baseCreateCallback",["../functions/bind","../utilities/identity","./setBindData","../support"],function(e,t,n,r){function i(i,c,u){if("function"!=typeof i)return t;if("undefined"==typeof c||!("prototype"in i))return i;var l=i.__bindData__;if("undefined"==typeof l&&(r.funcNames&&(l=!i.name),l=l||!r.funcDecomp,!l)){var d=s.call(i);r.funcNames||(l=!o.test(d)),l||(l=a.test(d),n(i,l))}if(l===!1||l!==!0&&1&l[1])return i;switch(u){case 1:return function(e){return i.call(c,e)};case 2:return function(e,t){return i.call(c,e,t)};case 3:return function(e,t,n){return i.call(c,e,t,n)};case 4:return function(e,t,n,r){return i.call(c,e,t,n,r)}}return e(i,c)}var o=/^\s*function[ \n\r\t]+\w/,a=/\bthis\b/,s=Function.prototype.toString;return i}),define("lodash-modern/objects/forOwn",["../internals/baseCreateCallback","./keys","../internals/objectTypes"],function(e,t,n){var r=function(r,i,o){var a,s=r,c=s;if(!s)return c;if(!n[typeof s])return c;i=i&&"undefined"==typeof o?i:e(i,o,3);for(var u=-1,l=n[typeof s]&&t(s),d=l?l.length:0;++u<d;)if(a=l[u],i(s[a],a,r)===!1)return c;return c};return r}),define("lodash-modern/objects/isArray",["../internals/isNative"],function(e){var t="[object Array]",n=Object.prototype,r=n.toString,i=e(i=Array.isArray)&&i,o=i||function(e){return e&&"object"==typeof e&&"number"==typeof e.length&&r.call(e)==t||!1};return o}),define("lodash-modern/objects/isString",[],function(){function e(e){return"string"==typeof e||e&&"object"==typeof e&&r.call(e)==t||!1}var t="[object String]",n=Object.prototype,r=n.toString;return e}),define("lodash-modern/collections/contains",["../internals/baseIndexOf","../objects/forOwn","../objects/isArray","../objects/isString"],function(e,t,n,r){function i(i,a,s){var c=-1,u=e,l=i?i.length:0,d=!1;return s=(0>s?o(0,l+s):s)||0,n(i)?d=u(i,a,s)>-1:"number"==typeof l?d=(r(i)?i.indexOf(a,s):u(i,a,s))>-1:t(i,function(e){return++c>=s?!(d=e===a):void 0}),d}var o=Math.max;return i}),define("plugins/core/commands/insert-html",["lodash-modern/collections/contains"],function(e){return function(){return function(t){function n(t){return e(r,t.nodeName)}var r=["P","LI","DIV","BLOCKQUOTE","UL","OL","H2"],i=new t.api.Command("insertHTML");i.execute=function(e){t.allowsBlockElements()?t.transactionManager.run(function(){function r(e){for(var t=document.createTreeWalker(e,NodeFilter.SHOW_TEXT|NodeFilter.SHOW_ELEMENT),i=t.firstChild(),o=!e.parentNode;i;){if(!(n(i)||"BLOCKQUOTE"!==e.nodeName&&n(e)&&!o)){var a=document.createElement("p");e.insertBefore(a,i),a.appendChild(i),r(e);break}r(i),i=t.nextSibling()}}var i=document.createElement("div");i.innerHTML=e,r(i);var o=i.innerHTML;t.api.Command.prototype.execute.call(this,o)}.bind(this)):t.api.Command.prototype.execute.call(this,e)},t.commands.insertHTML=i}}}),define("plugins/core/commands/insert-list",[],function(){return function(){return function(e){var t=function(t){e.api.Command.call(this,t)};t.prototype=Object.create(e.api.Command.prototype),t.prototype.constructor=t,t.prototype.execute=function(t){function n(e){if(e.length>0){var t=document.createElement(o.nodeName);e.forEach(function(e){t.appendChild(e)}),o.parentNode.insertBefore(t,o.nextElementSibling)}}if(this.queryState()){var r=new e.api.Selection,i=r.range,o=r.getContaining(function(e){return"OL"===e.nodeName||"UL"===e.nodeName}),a=r.getContaining(function(e){return"LI"===e.nodeName});e.transactionManager.run(function(){if(a){var t=new e.api.Node(a).nextAll();n(t),r.placeMarkers();var s=document.createElement("p");s.innerHTML=a.innerHTML,o.parentNode.insertBefore(s,o.nextElementSibling),a.parentNode.removeChild(a)}else{var c=Array.prototype.map.call(o.querySelectorAll("li"),function(e){return i.intersectsNode(e)&&e}).filter(function(e){return e}),u=c.slice(-1)[0],l=new e.api.Node(u).nextAll();n(l),r.placeMarkers();var d=document.createDocumentFragment();c.forEach(function(e){var t=document.createElement("p");t.innerHTML=e.innerHTML,d.appendChild(t)}),o.parentNode.insertBefore(d,o.nextElementSibling),c.forEach(function(e){e.parentNode.removeChild(e)})}0===o.childNodes.length&&o.parentNode.removeChild(o),r.selectMarkers()}.bind(this))}else e.api.Command.prototype.execute.call(this,t)},t.prototype.queryEnabled=function(){return e.api.Command.prototype.queryEnabled.call(this)&&e.allowsBlockElements()},e.commands.insertOrderedList=new t("insertOrderedList"),e.commands.insertUnorderedList=new t("insertUnorderedList")}}}),define("plugins/core/commands/outdent",[],function(){return function(){return function(e){var t=new e.api.Command("outdent");t.queryEnabled=function(){var t=new e.api.Selection,n=t.getContaining(function(e){return"UL"===e.nodeName||"OL"===e.nodeName});return e.api.Command.prototype.queryEnabled.call(this)&&e.allowsBlockElements()&&!n},e.commands.outdent=t}}}),define("plugins/core/commands/redo",[],function(){return function(){return function(e){var t=new e.api.Command("redo");t.execute=function(){var t=e.undoManager.redo();"undefined"!=typeof t&&e.restoreFromHistory(t)},t.queryEnabled=function(){return e.undoManager.position<e.undoManager.stack.length-1},e.commands.redo=t,e.el.addEventListener("keydown",function(e){e.shiftKey&&(e.metaKey||e.ctrlKey)&&90===e.keyCode&&(e.preventDefault(),t.execute())})}}}),define("plugins/core/commands/undo",[],function(){return function(){return function(e){var t=new e.api.Command("undo");t.execute=function(){var t=e.undoManager.undo();"undefined"!=typeof t&&e.restoreFromHistory(t)},t.queryEnabled=function(){return e.undoManager.position>1},e.commands.undo=t,e.el.addEventListener("keydown",function(e){e.shiftKey||!e.metaKey&&!e.ctrlKey||90!==e.keyCode||(e.preventDefault(),t.execute())})}}}),define("plugins/core/commands",["./commands/indent","./commands/insert-html","./commands/insert-list","./commands/outdent","./commands/redo","./commands/undo"],function(e,t,n,r,i,o){return{indent:e,insertHTML:t,insertList:n,outdent:r,redo:i,undo:o}}),define("plugins/core/formatters/replace-nbsp-chars",[],function(){return function(){return function(e){var t="&nbsp;| ",n=new RegExp(t,"g");e.formatter.formatters.push(function(e){return e.replace(n," ")})}}}),define("plugins/core/patches/commands/bold",[],function(){return function(){return function(e){var t=new e.api.CommandPatch("bold");t.queryEnabled=function(){var t=new e.api.Selection,n=t.getContaining(function(e){return/^(H[1-6])$/.test(e.nodeName)});return e.api.CommandPatch.prototype.queryEnabled.apply(this,arguments)&&!n},e.commandPatches.bold=t}}}),define("plugins/core/patches/commands/indent",[],function(){var e="﻿";return function(){return function(t){var n=new t.api.CommandPatch("indent");n.execute=function(n){t.transactionManager.run(function(){var r=new t.api.Selection,i=r.range;if("P"===i.commonAncestorContainer.nodeName){var o=document.createTextNode(e);i.insertNode(o),i.setStart(o,0),i.setEnd(o,0),r.selection.removeAllRanges(),r.selection.addRange(i)}t.api.CommandPatch.prototype.execute.call(this,n),r=new t.api.Selection;var a=r.getContaining(function(e){return"BLOCKQUOTE"===e.nodeName});a&&a.removeAttribute("style")}.bind(this))},t.commandPatches.indent=n}}}),define("plugins/core/patches/commands/insert-html",[],function(){return function(){return function(e){var t=new e.api.CommandPatch("insertHTML");t.execute=function(t){e.transactionManager.run(function(){function n(t){var r=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT),i=r.firstChild();if(i)do"SPAN"===i.nodeName?new e.api.Element(t).unwrap(i):(i.style.lineHeight=null,""===i.getAttribute("style")&&i.removeAttribute("style")),n(i);while(i=r.nextSibling())}e.api.CommandPatch.prototype.execute.call(this,t),n(e.el)}.bind(this))},e.commandPatches.insertHTML=t}}}),define("plugins/core/patches/commands/insert-list",[],function(){return function(){return function(e){var t=function(t){e.api.CommandPatch.call(this,t)};t.prototype=Object.create(e.api.CommandPatch.prototype),t.prototype.constructor=t,t.prototype.execute=function(t){e.transactionManager.run(function(){if(e.api.CommandPatch.prototype.execute.call(this,t),this.queryState()){var n=new e.api.Selection,r=n.getContaining(function(e){return"OL"===e.nodeName||"UL"===e.nodeName});if(r){var i=r.parentNode;i&&/^(H[1-6]|P)$/.test(i.nodeName)&&(n.placeMarkers(),i.parentNode.insertBefore(r,i.nextElementSibling),n.selectMarkers(),i.parentNode.removeChild(i))}var o=Array.prototype.slice.call(r.childNodes);o.forEach(function(t){var n=Array.prototype.slice.call(t.childNodes);n.forEach(function(n){if("SPAN"===n.nodeName){var r=n;new e.api.Element(t).unwrap(r)}else n.nodeType===Node.ELEMENT_NODE&&(n.style.lineHeight=null,""===n.getAttribute("style")&&n.removeAttribute("style"))})})}}.bind(this))},e.commandPatches.insertOrderedList=new t("insertOrderedList"),e.commandPatches.insertUnorderedList=new t("insertUnorderedList")}}}),define("plugins/core/patches/commands/outdent",[],function(){return function(){return function(e){var t=new e.api.CommandPatch("outdent");t.execute=function(){e.transactionManager.run(function(){var t=new e.api.Selection,n=t.range;if("BLOCKQUOTE"===n.commonAncestorContainer.nodeName){var r=n.commonAncestorContainer;t.placeMarkers(),t.selectMarkers(!0);var i=n.cloneContents();r.parentNode.insertBefore(i,r),n.deleteContents(),t.selectMarkers(),""===r.innerText&&r.parentNode.removeChild(r)}else{var o=t.getContaining(function(e){return"P"===e.nodeName});if(o){var r=t.getContaining(function(e){return"BLOCKQUOTE"===e.nodeName}),a=new e.api.Node(o).nextAll();if(a.length){var s=document.createElement(r.nodeName);a.forEach(function(e){s.appendChild(e)}),r.parentNode.insertBefore(s,r.nextElementSibling)}t.placeMarkers(),r.parentNode.insertBefore(o,r.nextElementSibling),t.selectMarkers(),""===r.innerHTML&&r.parentNode.removeChild(r)}else e.api.CommandPatch.prototype.execute.call(this)}}.bind(this))},e.commandPatches.outdent=t}}}),define("plugins/core/patches/empty-when-deleting",[],function(){return function(){return function(e){function t(e){var t=document.createElement("div"),n=e.cloneContents();return t.appendChild(n),t.innerHTML}function n(n){var r=t(n),i=document.createRange();i.selectNodeContents(e.el);var o=t(i);return r===o}e.el.addEventListener("keydown",function(t){if(8===t.keyCode||46===t.keyCode){var r=new e.api.Selection,i=r.selection.isCollapsed,o=n(r.range);(i&&""===e.getTextContent().trim()||!i&&o)&&(t.preventDefault(),e.setHTML('<p><em class="scribe-marker"></em><br></p>'),r.selectMarkers(),e.pushHistory(),e.trigger("content-changed"))}})}}}),define("plugins/core/patches/events",[],function(){return function(){return function(e){e.allowsBlockElements()&&e.el.addEventListener("keyup",function(t){if(8===t.keyCode||46===t.keyCode){var n=new e.api.Selection,r=n.range;if(r.collapsed){var i=n.getContaining(function(e){return"P"===e.nodeName});if(i){n.placeMarkers();var o=Array.prototype.slice.call(i.childNodes);o.forEach(function(t){if("SPAN"===t.nodeName){var n=t;new e.api.Element(i).unwrap(n)}else t.nodeType===Node.ELEMENT_NODE&&(t.style.lineHeight=null,""===t.getAttribute("style")&&t.removeAttribute("style"))}),n.selectMarkers()}}}})}}}),define("plugins/core/patches",["./patches/commands/bold","./patches/commands/indent","./patches/commands/insert-html","./patches/commands/insert-list","./patches/commands/outdent","./patches/empty-when-deleting","./patches/events"],function(e,t,n,r,i,o,a){return{commands:{bold:e,indent:t,insertHTML:n,insertList:r,outdent:i},emptyWhenDeleting:o,events:a}}),define("plugins/core/events",[],function(){return function(){return function(e){function t(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}e.allowsBlockElements()&&e.el.addEventListener("keydown",function(t){if(13===t.keyCode){var n=new e.api.Selection,r=n.range,i=n.getContaining(function(e){return/^(H[1-6])$/.test(e.nodeName)});if(i&&r.collapsed){var o=r.cloneRange();o.setEndAfter(i,0);var a=o.cloneContents();if(""===a.firstChild.innerText){t.preventDefault();var s=document.createElement("p"),c=document.createElement("br");s.appendChild(c),i.parentNode.insertBefore(s,i.nextElementSibling),r.setStart(s,0),r.setEnd(s,0),n.selection.removeAllRanges(),n.selection.addRange(r),e.pushHistory(),e.trigger("content-changed")}}}}),e.allowsBlockElements()&&e.el.addEventListener("keydown",function(t){if(13===t.keyCode||8===t.keyCode){var n=new e.api.Selection,r=n.range;if(r.collapsed){var i=n.getContaining(function(e){return"LI"===e.nodeName});if(i&&""===i.innerText.trim()){t.preventDefault();var o=n.getContaining(function(e){return"UL"===e.nodeName||"OL"===e.nodeName}),a=e.getCommand("OL"===o.nodeName?"insertOrderedList":"insertUnorderedList");a.execute()}}}}),e.el.addEventListener("paste",function(n){var r;if(n.clipboardData)n.preventDefault(),r=n.clipboardData.getData("text/html")||t(n.clipboardData.getData("text/plain")),e.insertHTML(r);else{var i=new e.api.Selection;i.placeMarkers();var o=document.createElement("div");document.body.appendChild(o),o.setAttribute("contenteditable",!0),o.focus(),setTimeout(function(){r=o.innerHTML,o.parentNode.removeChild(o),i.selectMarkers(),e.el.focus(),e.insertHTML(r)},1)}})}}}),define("api/command-patch",[],function(){return function(e){function t(e){this.commandName=e}return t.prototype.execute=function(t){e.transactionManager.run(function(){document.execCommand(this.commandName,!1,t||null)}.bind(this))},t.prototype.queryState=function(){return document.queryCommandState(this.commandName)},t.prototype.queryEnabled=function(){return document.queryCommandEnabled(this.commandName)},t}}),define("api/command",[],function(){return function(e){function t(t){this.commandName=t,this.patch=e.commandPatches[this.commandName]}return t.prototype.execute=function(t){this.patch?this.patch.execute(t):e.transactionManager.run(function(){document.execCommand(this.commandName,!1,t||null)}.bind(this))},t.prototype.queryState=function(){return this.patch?this.patch.queryState():document.queryCommandState(this.commandName)},t.prototype.queryEnabled=function(){return this.patch?this.patch.queryEnabled():document.queryCommandEnabled(this.commandName)},t}}),define("api/node",[],function(){function e(e){this.node=e}return e.prototype.getAncestor=function(e){var t=this.node;do{if(e(t))return t;if(t=t.parentNode,t&&t.attributes&&t.attributes.getNamedItem("contenteditable"))return void(t=null)}while(t)},e.prototype.nextAll=function(){for(var e=[],t=this.node;t=t.nextSibling;)e.push(t);return e},e}),define("api/element",["./node"],function(e){function t(t){e.call(this,t)}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.prototype.unwrap=function(e){for(;e.childNodes.length>0;)this.node.insertBefore(e.childNodes[0],e);this.node.removeChild(e)},t}),define("api/selection",[],function(){return function(e){function t(){this.selection=window.getSelection(),this.selection.rangeCount&&(this.range=this.selection.getRangeAt(0))}return t.prototype.getContaining=function(t){var n=new e.api.Node(this.range.commonAncestorContainer);return n.getAncestor(t)},t.prototype.placeMarkers=function(){var e=document.createElement("em");e.classList.add("scribe-marker");var t=document.createElement("em");t.classList.add("scribe-marker");var n=this.range.cloneRange();if(n.collapse(!1),n.insertNode(t),t.nextSibling&&3===t.nextSibling.nodeType&&""===t.nextSibling.data&&t.parentNode.removeChild(t.nextSibling),!this.range.collapsed){var r=this.range.cloneRange();r.collapse(!0),r.insertNode(e),e.nextSibling&&3===e.nextSibling.nodeType&&""===e.nextSibling.data&&e.parentNode.removeChild(e.nextSibling)}this.selection.removeAllRanges(),this.selection.addRange(this.range)},t.prototype.getMarkers=function(){return e.el.querySelectorAll("em.scribe-marker")},t.prototype.removeMarkers=function(){var e=this.getMarkers();Array.prototype.forEach.call(e,function(e){e.parentNode.removeChild(e)})},t.prototype.selectMarkers=function(e){var t=this.getMarkers();t.length&&(this.range.setStartBefore(t[0]),this.range.setEndAfter(t.length>=2?t[1]:t[0]),e||this.removeMarkers(),this.selection.removeAllRanges(),this.selection.addRange(this.range))},t}}),define("api/simple-command",[],function(){return function(e,t){function n(e,n){t.api.Command.call(this,e),this.nodeName=n}return n.prototype=Object.create(e.Command.prototype),n.prototype.constructor=n,n.prototype.queryState=function(){var e=new t.api.Selection;return t.api.Command.prototype.queryState.call(this)&&!!e.getContaining(function(e){return e.nodeName===this.nodeName}.bind(this))},n}}),define("api",["./api/command-patch","./api/command","./api/element","./api/node","./api/selection","./api/simple-command"],function(e,t,n,r,i,o){return function(a){this.CommandPatch=e(a),this.Command=t(a),this.Element=n,this.Node=r,this.Selection=i(a),this.SimpleCommand=o(this,a)}}),define("lodash-modern/objects/assign",["../internals/baseCreateCallback","./keys","../internals/objectTypes"],function(e,t,n){var r=function(r,i,o){var a,s=r,c=s;if(!s)return c;var u=arguments,l=0,d="number"==typeof o?2:u.length;if(d>3&&"function"==typeof u[d-2])var f=e(u[--d-1],u[d--],2);else d>2&&"function"==typeof u[d-1]&&(f=u[--d]);for(;++l<d;)if(s=u[l],s&&n[typeof s])for(var p=-1,m=n[typeof s]&&t(s),h=m?m.length:0;++p<h;)a=m[p],c[a]=f?f(c[a],s[a]):s[a];return c};return r}),define("transaction-manager",["lodash-modern/objects/assign"],function(e){return function(t){function n(){this.history=[]}return e(n.prototype,{start:function(){this.history.push(1)},end:function(){this.history.pop(),0===this.history.length&&(t.pushHistory(),t.trigger("content-changed"))},run:function(e){this.start();try{e&&e()}finally{this.end()}}}),n}}),define("undo-manager",[],function(){function e(){this.position=0,this.stack=[]}return e.prototype.maxStackSize=100,e.prototype.push=function(e){for(console.log("UndoManager.push: %s",e),this.stack.length=++this.position,this.stack.push(e);this.stack.length>this.maxStackSize;)this.stack.shift(),--this.position},e.prototype.undo=function(){return this.position>1?this.stack[--this.position]:void 0},e.prototype.redo=function(){return this.position<this.stack.length-1?this.stack[++this.position]:void 0},e}),define("scribe",["event-emitter","lodash-modern/objects/defaults","./initializers/root-paragraph-element","./initializers/insert-br-on-return","./plugins/core/commands","./plugins/core/formatters/replace-nbsp-chars","./plugins/core/patches","./plugins/core/events","./api","./transaction-manager","./undo-manager"],function(e,t,n,r,i,o,a,s,c,u,l){function d(e,d){this.el=e,this.commands={},this.options=t(d||{},{allowBlockElements:!0}),this.commandPatches={},this.initializers=[],this.formatter=new f,this.api=new c(this);var p=u(this);this.undoManager=new l,this.transactionManager=new p,this.el.addEventListener("input",function(){setTimeout(function(){this.transactionManager.run()}.bind(this),0)}.bind(this),!1),this.addInitializer(this.allowsBlockElements()?n():r()),this.use(o()),this.use(a.commands.bold()),this.use(a.commands.indent()),this.use(a.commands.insertHTML()),this.use(a.commands.insertList()),this.use(a.commands.outdent()),this.allowsBlockElements()&&this.use(a.emptyWhenDeleting()),this.use(a.events()),this.use(i.indent()),this.use(i.insertHTML()),this.use(i.insertList()),this.use(i.outdent()),this.use(i.redo()),this.use(i.undo()),this.use(s());var m=function(){setTimeout(function(){this.pushHistory()}.bind(this),0),this.el.removeEventListener("focus",m)}.bind(this);this.el.addEventListener("focus",function(){function e(t){var n=document.createTreeWalker(t),r=n.currentNode;return n.firstChild()?"BR"===n.currentNode.nodeName?r:e(n.currentNode):n.currentNode}var t=new this.api.Selection;if(t.range){t.placeMarkers();var n=this.allowsBlockElements()&&this.getHTML().match(/^<em class="scribe-marker"><\/em>/);if(t.removeMarkers(),n){var r=e(this.el.firstChild),i=t.range;i.setStart(r,0),i.setEnd(r,0),t.selection.removeAllRanges(),t.selection.addRange(i)}}}.bind(this)),this.el.addEventListener("focus",m)}function f(){this.formatters=[]}return d.prototype=Object.create(e.prototype),d.prototype.initialize=function(){this.el.setAttribute("contenteditable",!0),this.initializers.forEach(function(e){e(this)},this)},d.prototype.use=function(e){return e(this),this},d.prototype.addInitializer=function(e){return this.initializers.push(e),this},d.prototype.setHTML=function(e){this.el.innerHTML=e},d.prototype.getHTML=function(){return this.el.innerHTML},d.prototype.getContent=function(){return this.getHTML().replace(/<br>$/,"")},d.prototype.getTextContent=function(){return this.el.textContent},d.prototype.pushHistory=function(){var e=this.undoManager.stack[this.undoManager.position],t=e&&e.replace(/<em class="scribe-marker">/g,"").replace(/<\/em>/g,"");if(!e||e&&this.getContent()!==t){var n=new this.api.Selection;n.placeMarkers();var r=this.getHTML();return n.removeMarkers(),this.undoManager.push(r),!0}return!1},d.prototype.getCommand=function(e){return this.commands[e]||this.commandPatches[e]||new this.api.Command(e)},d.prototype.restoreFromHistory=function(e){this.setHTML(e);var t=new this.api.Selection;t.selectMarkers(),this.trigger("content-changed")},d.prototype.allowsBlockElements=function(){return this.options.allowBlockElements},d.prototype.setContent=function(e){this.allowsBlockElements()||(e+="<br>"),this.setHTML(this.formatter.format(e)),this.trigger("content-changed")},d.prototype.insertHTML=function(e){this.getCommand("insertHTML").execute(this.formatter.format(e))},f.prototype.format=function(e){var t=this.formatters.reduce(function(e,t){return t(e)},e);return t},d});//# sourceMappingURL=scribe.min.js.map